"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var IntersectionObserverPolyFill=function(){function a(a){try{return a.defaultView&&a.defaultView.frameElement||null}catch(a){return null}}function b(a){this.time=a.time,this.target=a.target,this.rootBounds=k(a.rootBounds),this.boundingClientRect=k(a.boundingClientRect),this.intersectionRect=k(a.intersectionRect||j()),this.isIntersecting=!!a.intersectionRect;var b=this.boundingClientRect,c=b.width*b.height,d=this.intersectionRect,e=d.width*d.height;this.intersectionRatio=c?+(e/c).toFixed(4):this.isIntersecting?1:0}function c(a,b){var c=b||{};if("function"!=typeof a)throw new Error("callback must be a function");if(c.root&&1!=c.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=e(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=a,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(c.rootMargin),this.thresholds=this._initThresholds(c.threshold),this.root=c.root||null,this.rootMargin=this._rootMarginValues.map(function(a){return a.value+a.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function d(){return window.performance&&performance.now&&performance.now()}function e(a,b){var c=null;return function(){c||(c=setTimeout(function(){a(),c=null},b))}}function f(a,b,c,d){"function"==typeof a.addEventListener?a.addEventListener(b,c,d||!1):"function"==typeof a.attachEvent&&a.attachEvent("on"+b,c)}function g(a,b,c,d){"function"==typeof a.removeEventListener?a.removeEventListener(b,c,d||!1):"function"==typeof a.detatchEvent&&a.detatchEvent("on"+b,c)}function h(a,b){var c=Math.min,d=Math.max,e=d(a.top,b.top),f=c(a.bottom,b.bottom),g=d(a.left,b.left),h=c(a.right,b.right),i=h-g,j=f-e;return 0<=i&&0<=j&&{top:e,bottom:f,left:g,right:h,width:i,height:j}||null}function i(a){var b;try{b=a.getBoundingClientRect()}catch(a){}return b?(b.width&&b.height||(b={top:b.top,right:b.right,bottom:b.bottom,left:b.left,width:b.right-b.left,height:b.bottom-b.top}),b):j()}function j(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function k(a){return!a||"x"in a?a:{top:a.top,y:a.top,bottom:a.bottom,left:a.left,x:a.left,right:a.right,width:a.width,height:a.height}}function l(a,b){var c=b.top-a.top,d=b.left-a.left;return{top:c,left:d,height:b.height,width:b.width,bottom:c+b.height,right:d+b.width}}function m(a,b){for(var c=b;c;){if(c==a)return!0;c=n(c)}return!1}function n(b){var c=b.parentNode;return 9==b.nodeType&&b!=o?a(b):c&&11==c.nodeType&&c.host?c.host:c&&c.assignedSlot?c.assignedSlot.parentNode:c}if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return void("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function get(){return 0<this.intersectionRatio}}));var o=function(b){for(var c=b,d=a(c);d;)c=d.ownerDocument,d=a(c);return c}(window.document),p=[],q=null,r=null;c.prototype.THROTTLE_TIMEOUT=100,c.prototype.POLL_INTERVAL=null,c.prototype.USE_MUTATION_OBSERVER=!0,c._setupCrossOriginUpdater=function(){return q||(q=function(a,b){r=a&&b?l(a,b):j(),p.forEach(function(a){a._checkForIntersections()})}),q},c._resetCrossOriginUpdater=function(){q=null,r=null},c.prototype.observe=function(a){var b=this._observationTargets.some(function(b){return b.element==a});if(!b){if(!(a&&1==a.nodeType))throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:a,entry:null}),this._monitorIntersections(a.ownerDocument),this._checkForIntersections()}},c.prototype.unobserve=function(a){this._observationTargets=this._observationTargets.filter(function(b){return b.element!=a}),this._unmonitorIntersections(a.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},c.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},c.prototype.takeRecords=function(){var a=this._queuedEntries.slice();return this._queuedEntries=[],a},c.prototype._initThresholds=function(a){var b=a||[0];return Array.isArray(b)||(b=[b]),b.sort().filter(function(b,c,d){if("number"!=typeof b||isNaN(b)||0>b||1<b)throw new Error("threshold must be a number between 0 and 1 inclusively");return b!==d[c-1]})},c.prototype._parseRootMargin=function(a){var b=(a||"0px").split(/\s+/).map(function(a){var b=/^(-?\d*\.?\d+)(px|%)$/.exec(a);if(!b)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(b[1]),unit:b[2]}});return b[1]=b[1]||b[0],b[2]=b[2]||b[0],b[3]=b[3]||b[1],b},c.prototype._monitorIntersections=function(b){var c=b.defaultView;if(c&&-1==this._monitoringDocuments.indexOf(b)){var d=this._checkForIntersections,e=null,h=null;if(this.POLL_INTERVAL?e=c.setInterval(d,this.POLL_INTERVAL):(f(c,"resize",d,!0),f(b,"scroll",d,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in c&&(h=new c.MutationObserver(d),h.observe(b,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))),this._monitoringDocuments.push(b),this._monitoringUnsubscribes.push(function(){var a=b.defaultView;a&&(e&&a.clearInterval(e),g(a,"resize",d,!0)),g(b,"scroll",d,!0),h&&h.disconnect()}),b!=(this.root&&this.root.ownerDocument||o)){var i=a(b);i&&this._monitorIntersections(i.ownerDocument)}}},c.prototype._unmonitorIntersections=function(b){var c=this._monitoringDocuments.indexOf(b);if(-1!=c){var d=this.root&&this.root.ownerDocument||o,e=this._observationTargets.some(function(c){var e=c.element.ownerDocument;if(e==b)return!0;for(;e&&e!=d;){var f=a(e);if(e=f&&f.ownerDocument,e==b)return!0}return!1});if(!e){var f=this._monitoringUnsubscribes[c];if(this._monitoringDocuments.splice(c,1),this._monitoringUnsubscribes.splice(c,1),f(),b!=d){var g=a(b);g&&this._unmonitorIntersections(g.ownerDocument)}}}},c.prototype._unmonitorAllIntersections=function(){var a=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var b=0;b<a.length;b++)a[b]()},c.prototype._checkForIntersections=function(){if(this.root||!q||r){var a=this._rootIsInDom(),c=a?this._getRootRect():j();this._observationTargets.forEach(function(e){var f=e.element,g=i(f),h=this._rootContainsTarget(f),j=e.entry,k=a&&h&&this._computeTargetAndRootIntersection(f,g,c),l=e.entry=new b({time:d(),target:f,boundingClientRect:g,rootBounds:q&&!this.root?null:c,intersectionRect:k});j?a&&h?this._hasCrossedThreshold(j,l)&&this._queuedEntries.push(l):j&&j.isIntersecting&&this._queuedEntries.push(l):this._queuedEntries.push(l)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},c.prototype._computeTargetAndRootIntersection=function(a,b,c){if("none"!=window.getComputedStyle(a).display){for(var d=b,e=n(a),f=!1;!f&&e;){var g=null,j=1==e.nodeType?window.getComputedStyle(e):{};if("none"==j.display)return null;if(e!=this.root&&9!=e.nodeType){var k=e.ownerDocument;e!=k.body&&e!=k.documentElement&&"visible"!=j.overflow&&(g=i(e))}else if(f=!0,e==this.root||e==o)q&&!this.root?r&&(0!=r.width||0!=r.height)?g=r:(e=null,g=null,d=null):g=c;else{var m=n(e),p=m&&i(m),s=m&&this._computeTargetAndRootIntersection(m,p,c);p&&s?(e=m,g=l(p,s)):(e=null,d=null)}if(g&&(d=h(g,d)),!d)break;e=e&&n(e)}return d}},c.prototype._getRootRect=function(){var a;if(this.root)a=i(this.root);else{var b=o.documentElement,c=o.body;a={top:0,left:0,right:b.clientWidth||c.clientWidth,width:b.clientWidth||c.clientWidth,bottom:b.clientHeight||c.clientHeight,height:b.clientHeight||c.clientHeight}}return this._expandRectByRootMargin(a)},c.prototype._expandRectByRootMargin=function(a){var b=this._rootMarginValues.map(function(b,c){return"px"==b.unit?b.value:b.value*(c%2?a.width:a.height)/100}),c={top:a.top-b[0],right:a.right+b[1],bottom:a.bottom+b[2],left:a.left-b[3]};return c.width=c.right-c.left,c.height=c.bottom-c.top,c},c.prototype._hasCrossedThreshold=function(a,b){var c=a&&a.isIntersecting?a.intersectionRatio||0:-1,d=b.isIntersecting?b.intersectionRatio||0:-1;if(c!==d)for(var e,f=0;f<this.thresholds.length;f++)if(e=this.thresholds[f],e==c||e==d||e<c!=e<d)return!0},c.prototype._rootIsInDom=function(){return!this.root||m(o,this.root)},c.prototype._rootContainsTarget=function(a){return m(this.root||o,a)&&(!this.root||this.root.ownerDocument==a.ownerDocument)},c.prototype._registerInstance=function(){0>p.indexOf(this)&&p.push(this)},c.prototype._unregisterInstance=function(){var a=p.indexOf(this);-1!=a&&p.splice(a,1)},window.IntersectionObserver=c,window.IntersectionObserverEntry=b}},AnimateFrom=function(){function a(b){_classCallCheck(this,a),this.element=b,this._animateFromAttribute="data-jfs-from",this._animateRepeatAttribute="data-jfs-repeat",this.classes=this.element.getAttribute(this._animateFromAttribute)?this.element.getAttribute(this._animateFromAttribute).split(" "):[],this.repeat="string"==typeof this.element.getAttribute(this._animateRepeatAttribute),this.intersected=!1,this._init()}return _createClass(a,[{key:"_init",value:function _init(){this._addFromClassesToElement(),this._removeFromClassesBeforePrint()}},{key:"onEnterBottom",value:function onEnterBottom(){var a;this.intersected||((a=this.element.classList).remove.apply(a,_toConsumableArray(this.classes)),this.intersected=!0)}},{key:"onLeaveBottom",value:function onLeaveBottom(){var a;this.repeat&&((a=this.element.classList).add.apply(a,_toConsumableArray(this.classes)),this.intersected=!1)}},{key:"_addFromClassesToElement",value:function _addFromClassesToElement(){var a;this.element.style.transition="none",(a=this.element.classList).add.apply(a,_toConsumableArray(this.classes)),void this.element.offsetHeight,this.element.style.removeProperty("transition")}},{key:"_removeFromClassesBeforePrint",value:function _removeFromClassesBeforePrint(){var a=this;window.addEventListener("beforeprint",function(){var b;(b=a.element.classList).remove.apply(b,_toConsumableArray(a.classes))})}}]),a}(),LazyLoadingImage=function(){function a(b){_classCallCheck(this,a),this.element=b,this._lazyloadAttribute="data-jfs-lazyload",this._lazyloadFromAttribute="data-jfs-lazyload-from",this.src=this.element.getAttribute(this._lazyloadAttribute),this.classes=this.element.getAttribute(this._lazyloadFromAttribute)?this.element.getAttribute(this._lazyloadFromAttribute).split(" "):[],this._setPlaceholderClasses()}return _createClass(a,[{key:"onEnterBottom",value:function onEnterBottom(){var a=this;this.element.src=this.src,this.element.addEventListener("load",function(){a.classes.forEach(function(b){a.element.classList.remove(b)})})}},{key:"_setPlaceholderClasses",value:function _setPlaceholderClasses(){var a=this;this.classes.forEach(function(b){a.element.classList.add(b)})}}]),a}();IntersectionObserverPolyFill();var JustForShow=function(){function a(b,c){return _classCallCheck(this,a),this.selector=b,this.selector&&"string"==typeof this.selector?(this.options=this._setOptions(c))?void(this.preset=this.options.preset,this.syncScrollPosition=this.options.syncScrollPosition,this.root=this.options.root,this.rootMargin=this.options.rootMargin,this.threshold=this.options.threshold,this.onEnterBottom=this.options.onEnterBottom,this.onEnterTop=this.options.onEnterTop,this.onLeaveBottom=this.options.onLeaveBottom,this.onLeaveTop=this.options.onLeaveTop,this.elements=_toConsumableArray(document.querySelectorAll(b)),this.instances=this._createInstances(),this.scrollPosition=this._getScrollPosition(),this.observer=this._createIntersectionObserver(),this._init()):void console.error("JustForShow: The options you defined are not valid or empty. Without valid options my existence is meaningless."):void console.error("JustForShow: If you don't give me an element to observe, what am I even here for? Why are we here anyway?")}return _createClass(a,[{key:"_init",value:function _init(){this._observeElements(),this.syncScrollPosition&&this._syncToCurrentScrollPosition()}},{key:"_createInstances",value:function _createInstances(){var a=this,b=[];return this.elements.forEach(function(c){b.push({element:c,preset:a._createPreset(c),observating:!1})}),b}},{key:"_createPreset",value:function _createPreset(a){return this.preset?this.preset(a):null}},{key:"_createIntersectionObserver",value:function _createIntersectionObserver(){return new IntersectionObserver(this._intersectionObserverCallback.bind(this),{root:this.options.root,rootMargin:this.options.rootMargin,threshold:this.options.threshold})}},{key:"_observeElements",value:function _observeElements(){var a=this;this.instances.forEach(function(b){a.observer.observe(b.element)})}},{key:"_onEnterBottom",value:function _onEnterBottom(a){"function"==typeof this.onEnterBottom&&this.onEnterBottom(a.element),null!=this.preset&&a.preset.onEnterBottom&&"function"==typeof a.preset.onEnterBottom&&a.preset.onEnterBottom()}},{key:"_onEnterTop",value:function _onEnterTop(a){"function"==typeof this.onEnterTop&&this.onEnterTop(a.element),null!=this.preset&&a.preset.onEnterTop&&"function"==typeof a.preset.onEnterTop&&a.preset.onEnterTop()}},{key:"_onLeaveBottom",value:function _onLeaveBottom(a){"function"==typeof this.onLeaveBottom&&this.onLeaveBottom(a.element),null!=this.preset&&a.preset.onLeaveBottom&&"function"==typeof a.preset.onLeaveBottom&&a.preset.onLeaveBottom()}},{key:"_onLeaveTop",value:function _onLeaveTop(a){"function"==typeof this.onLeaveTop&&this.onLeaveTop(a.element),null!=this.preset&&a.preset.onLeaveTop&&"function"==typeof a.preset.onLeaveTop&&a.preset.onLeaveTop()}},{key:"_intersectionObserverCallback",value:function _intersectionObserverCallback(a){var b=this;a.forEach(function(a){var c=b._getScrollPosition(),d=b.instances.find(function(b){return b.element==a.target});return d.observating?void(c>=b.scrollPosition&&a.isIntersecting?b._onEnterBottom(d):c<b.scrollPosition&&a.isIntersecting?b._onEnterTop(d):c<b.scrollPosition&&!a.isIntersecting?b._onLeaveBottom(d):c>=b.scrollPosition&&!a.isIntersecting&&b._onLeaveTop(d),b.scrollPosition=c):void(d.observating=!0)})}},{key:"_getScrollPosition",value:function _getScrollPosition(){return window.pageYOffset||document.documentElement.scrollTop}},{key:"_syncToCurrentScrollPosition",value:function _syncToCurrentScrollPosition(){var a=this,b={top:window.pageYOffset,bottom:window.pageYOffset+window.innerHeight};this.instances.forEach(function(c){var d={top:c.element.getBoundingClientRect().top+b.top,bottom:c.element.getBoundingClientRect().bottom+b.top};d.top<b.bottom&&a._onEnterBottom(c),d.bottom<b.top&&a._onLeaveTop(c)})}},{key:"_setOptions",value:function _setOptions(a){return"string"!=typeof a&&"function"!=typeof a&&"object"!=_typeof(a)?null:(("string"==typeof a||"function"==typeof a)&&(a={preset:a}),{preset:a&&a.preset?this._setPresetOption(a.preset):null,syncScrollPosition:!(a&&null!=a.syncScrollPosition)||a.syncScrollPosition,root:a&&a.root?a.root:null,rootMargin:a&&a.rootMargin?a.rootMargin:"0px 0px 0px 0px",threshold:a&&a.threshold?a.threshold:[0],onEnterBottom:a&&a.onEnterBottom?a.onEnterBottom:null,onEnterTop:a&&a.onEnterTop?a.onEnterTop:null,onLeaveBottom:a&&a.onLeaveBottom?a.onLeaveBottom:null,onLeaveTop:a&&a.onLeaveTop?a.onLeaveTop:null})}},{key:"_setPresetOption",value:function _setPresetOption(a){var b=null;return"string"==typeof a?(b=this._getPresetTypes().find(function(b){return b.name===a}),b=b?b.create:null):"function"==typeof a&&(b=a),b||console.error("JustForShow: The preset you defined is invalid. Only listeners defined in JFS options will be fired."),b}},{key:"_getPresetTypes",value:function _getPresetTypes(){return[{name:"animate-from",create:function create(a){return new AnimateFrom(a)}},{name:"lazyload",create:function create(a){return new LazyLoadingImage(a)}}]}}]),a}(),_default=JustForShow;exports["default"]=_default;